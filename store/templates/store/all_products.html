{% extends "base.html" %}
{% load cart_extras %}

{% block title %}All Products{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h3 class="mb-0">All Products</h3>
    <form method="get" class="d-flex" style="gap:.5rem;">
      <input name="q" value="{{ q }}" class="form-control form-control-sm" placeholder="Search products...">
      {% if active_cat %}
        <input type="hidden" name="category" value="{{ active_cat }}">
      {% endif %}
      <button class="btn btn-sm btn-primary">Search</button>
    </form>
  </div>

  <div class="row">
    <!-- Sidebar Categories -->
    <div class="col-lg-3 col-md-4 mb-4">
      <h5 class="fw-bold mb-3 text-start">Categories</h5>
      <ul class="list-group shadow-sm rounded-3 overflow-hidden">
        <a class="list-group-item list-group-item-action {% if not active_category %}active{% endif %}" href="{% url 'store:all_products' %}">
          <i class="bi bi-grid me-2"></i> All
        </a>
        {% for c in categories %}
          <a class="list-group-item list-group-item-action {% if active_category and active_category.id == c.id %}active{% endif %}" href="{% url 'store:category' c.slug %}">
            <i class="bi bi-folder2-open me-2"></i> {{ c.name }}
          </a>
        {% endfor %}
      </ul>
    </div>

    <!-- Product Cards -->
    <div class="col-lg-9 col-md-8">
      <div class="row g-4">
        {% for p in products %}
        <div class="col-sm-6 col-lg-4">
          <div class="card h-100 border-0 shadow-lg rounded-4">
            {% if p.image %}
              <img src="{{ p.image.url }}" class="card-img-top rounded-top-4" style="height:180px;object-fit:cover;" alt="{{ p.title }}">
            {% else %}
              <img src="https://via.placeholder.com/300x200.png?text=No+Image"
                   class="card-img-top rounded-top-4" style="height:180px;object-fit:cover;" alt="{{ p.title }}">
            {% endif %}
            <div class="card-body d-flex flex-column">
              <h6 class="fw-bold text-truncate">{{ p.title }}</h6>
              <p class="small text-muted text-truncate">{{ p.description }}</p>
              <div class="mt-auto d-flex justify-content-between align-items-center">
                <span class="fw-bold text-success">{{ p.price|currency }}</span>
                <a href="{% url 'store:product_detail' p.slug %}" class="btn btn-outline-primary btn-sm rounded-pill">
                  <i class="bi bi-eye"></i> View
                </a>
              </div>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="col-12">
          <div class="alert alert-light border">No products found.</div>
        </div>
        {% endfor %}
      </div>

      <!-- Pagination -->
      {% if products.paginator.num_pages > 1 %}
      <nav class="mt-4">
        <ul class="pagination">
          {% if products.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ products.previous_page_number }}">« Prev</a></li>
          {% endif %}
          {% for num in products.paginator.page_range %}
            <li class="page-item {% if num == products.number %}active{% endif %}">
              <a class="page-link" href="?page={{ num }}">{{ num }}</a>
            </li>
          {% endfor %}
          {% if products.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ products.next_page_number }}">Next »</a></li>
          {% endif %}
        </ul>
      </nav>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
